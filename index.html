<!DOCTYPE HTML>
<html>
	<head>
		<title>R Time Series Issues - tsa4</title>
		<meta name="David Stoffer" content="David Stoffer" />
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<LINK REL="SHORTCUT ICON" HREF="favicon.ico"/>
        <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
		<LINK REL="SHORTCUT ICON" HREF="favicon.ico"/>
		<script type="text/javascript"  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
	</script>	

	</head>
	



		<!-- Header -->
			<header id="header">
				<div class="logo"><a href="index.html">Time Series <span> 4th Edition   </span></a>			 
				</div>
				<a href="#menu">Menu</a>
			</header>

		<!-- Nav -->
			<nav id="menu">
				<ul class="links">
					 <li><a href="http://www.stat.pitt.edu/stoffer/tsa4/">Home</a></li>
				    <li><a href="http://www.stat.pitt.edu/stoffer/tsda/" target="blank">Intro to Time Series Text</a></li> 
				    <li><a href="http://www.stat.pitt.edu/stoffer/tsa4/xChanges.htm">astsa</a></li>
				    <li><a href="http://www.stat.pitt.edu/stoffer/tsa4/Rexamples.htm">R tt used in the text</a></li>
					<li><a href="http://www.stat.pitt.edu/stoffer/tsa4/R_toot.htm">R time series tutorial</a></li>
					<li><a href="http://www.stat.pitt.edu/stoffer/tsa4/tsgraphics.htm">time series &amp; graphics in R</a></li>
					<li><a href="http://www.stat.pitt.edu/stoffer/tsa4/Rissues.htm"> R time series issues </a></li>
					<li><a href="http://www.stat.pitt.edu/stoffer/tsa4/chap6.htm"> State Space models  </a></li>
					<li><a href="http://www.stat.pitt.edu/stoffer/tsa4/arch.htm"> ARCH models  </a></li>
					<li><a href="http://www.stat.pitt.edu/stoffer/tsa4/errata.htm"> Errata +</a></li>
					<li><a href="https://github.com/nickpoison/" target="_blank"> R tt @ GitHub </a></li>
					<li><a href="https://www.datacamp.com/courses/arima-modeling-with-r" target="_blank">  Course @ DataCamp</a></li>
					<li><a href="http://www.stat.pitt.edu/stoffer/nltsa/" target="_blank">Nonlinear Time Series</a></li>
					<li><a href="http://www.stat.pitt.edu/stoffer/tsa2/tsa2.html" target="_blank">old 2nd edition site</a></li>
					<li><a href="http://www.stat.pitt.edu/stoffer/tsa3/tsa3.html" target="_blank">old 3rd edition site</a></li>
					<li><a href="https://cloud.r-project.org/" target="_blank">CRAN </a></li>
					<li><a href="https://link.springer.com/book/10.1007/978-3-319-52452-8" target="_blank"> Springer Link </a></li>

				</ul>
			</nav>

			<a name="top"></a>
		<!-- One -->	
			<section id="One" class="wrapper style3">
				<div class="inner">
					<header class="align-center">
						<p>OMG! </p>
						<h2>Some  Time Series Issues</h2>
						<h2>~ This Page is No Longer Maintained ~</h2>
					</header>
				</div>
			</section>
		
		<!-- Two -->


<style type="text/css"> 
 .content {color: #333;}	 
 .mylink a:link {color: #005a88;  font-weight: 400; 
		         text-decoration: none}
 .mylink a:visited {color: #005a88; font-weight: 400; 
                 text-decoration: none}      
 .mylink a:hover {text-decoration: underline  }     
 .up { border-top: 1px solid #ccc; text-align: right; margin-bottom: 10px; margin-top: 15px;
         font-size: 75%;  margin-right: 0px; margin-bottom: 30px}        
 .blue { color: 	#000088; }
 .blue2 { color: #25587E; font-weight: 400; }
 .red { color: #980000;}
 .green { color: #006666;}
 pre.prettyprint{	 
	background-color: #F8F8F8;   
	border-top: 1px dotted #888;	
    border-bottom: 1px solid #888;
    border-left: 5px solid #336699;
    padding: 10px;
    white-space: pre;
    line-height: 1.4em;
    font-family:  Consolas, Monaco, Lucida Console, 'PT Mono', monospace; overflow:auto;
    margin-bottom: 5px;
    margin-top: 5px;
  } 

 }
.mylink  
 sup,
 sub {
  height: 0; font-size: 80%;
  line-height: 1;
  vertical-align: baseline;
  _vertical-align: bottom;
  position: relative;
 }
.mylink sup {	bottom: 1ex;}
.mylink sub { 	top: .3ex;}    
.eqn {font-family:  Consolas, Monaco, Lucida Console, 'PT Mono', monospace;         }
</style>	

<div class="mylink">
			<section id="two" class="wrapper style2">
				<div class="inner">
					<div class="box">
						<div class="content">
							<header class="align-center">
							<p>  fun with R         </p>
								<h2> Why That Didn't Work </h2>
								
							</header>

	<p>There are a few items related to the analysis of  time series  with R that will have you scratching your head. 
The issues  mentioned below are meant to help get you past the sticky points.  
Most of the issues are related to the <code>stats</code> package, which is essentially a base package in that it is included with R, and loaded automatically when you start R.  If you use other time series packages that have scripts with the same or similar names, then these issues might not apply.  Then again, they just may apply because mistakes tend to propagate.   
  </p>		
	  
	  

<h2>Issue 1:  how will R end? </h2>  
<p>
The issue below has become a real pain as  the commercial enterprise that makes RStudio influences the R Foundation, which is a nonprofit organization.  Older folks saw this happen with R's father, S-PLUS.  Anybody using S-PLUS right now?</p>
  
<p>
A recent issue with the package <code>dplyr</code> and <code>lag</code> from the <code>stats</code>  package  came to my attention: you can read about it  in <a href="https://github.com/hadley/dplyr/commit/f8a46e030b7b899900f2091f41071619d0a46288" target="new"> how will R end... not with a bang but a package.</a>  The bottom line is, if you are working with time
    series and you load  <code>dplyr</code>, then you should know what it breaks... just be careful.</p>
	

In fact, you should be careful whenever you load a package.  For example:
<pre class="prettyprint">
# if I do this
library(dplyr)

# I will see this <SPAN STYLE="background-color: #e3e7ea">
 Attaching package: 'dplyr' 

 The following objects are masked from 'package:stats': 

     filter, lag     

 The following objects are masked from 'package:base': 

     intersect, setdiff, setequal, union      </span>

# it's a package fight!   	
</pre>	
To be safe, load packages consciously and watch for masked objects warnings.  I would say avoid loading <code>dplyr</code> if
you're analyzing time series interactively (the advantage of using R vs batch mode programs such as SAS). 

<br/><br/>
One fix if you're analyzing time series (or teaching a class) is to (tell students to) do the following after loading all the packages needed: 
<pre class="prettyprint">
filter = stats::filter
lag = stats::lag
</pre>
Now back to our regularly scheduled list of screw ups.<br/>
<br/>

&#9940; 
Oh yeah, so you're probably wondering how? ...  every package will nullify every other package until one day, you load R and it masks itself in an infinite do loop ...  &#9940; 
<br/>

<div class="up"><a href="#top" title="top">top</a></div>

<h2>Issue 2: don't use auto.arima </h2>  
This is another issue with packages, this time the <code>forecast</code> package.  I tend to see this kind of thing often now - don't look at the data, don't check residuals or any other kind of output ... just black box away:
<pre class="prettyprint">
# I don't know anything about fitting models to time series data, 
# so I used auto.arima from the forecast package.
library(forecast)
this.sux <- auto.arima(aTimeSeries)
plot(forecast(this.sux))
</pre>
Done!  Man, I am a bad ass data sci-un-tist!! 
Now I can leave work... I hope my boss appreciates my hard work. <br /> <img src="images2/badassdude.jpg" height=90 /><br/>

Here's a little test of <code>auto.arima()</code> success rates (not very good to say the least):
<a href="http://freerangestats.info/blog/2015/09/30/autoarima-success-rates"  target='new'>
Success rates of automated ARIMA fitting</a>.  The original (Windows) version of <code>astsa</code> had 
an automatic fitting procedure, which even for its time sucked.... it's why there is not one in the R package.
There's no excuse not to learn what you're doing before you do it.
 <br/><br/>

 A good idea when thinking about these kinds of ideas is to extend it to the extreme.  Let's see, how about this:
<pre class="prettyprint">
# I don't know anything about flying a plane, so 
# I'll use auto.pilot from the Trio_Avionics package.
library(Trio_Avionics)
crash_burn <- auto.pilot(this_plane)
forecast(my_life_expectancy)
   <span>AutoPilot Report
   You Have Just Crashed Into A Mountain  
   Black Box Search Begins Now
   Funeral In Four Days</span>
</pre>
That was fun... did I mention that the dude's boss didn't appreciate his hard work and fired him the next day? Not only because he used auto.arima, but because the dude is generally a dumb ass.

<br/><br/>Let's analyze a real data set.  I used to use <code>AirPassengers</code> because it gave a terrible result. That was changed 
somehow in <code>auto.arima</code>, but not generally - specifically for that data set!! Well, anything else I try is equally as bad.  I'll use a seasonal series from <code>astsa</code> called <code>UnempRate</code>, monthly US unemployment %s from 1948 thru 2016.
<pre class="prettyprint">
library(astsa)
library(forecast)
auto.arima(UnempRate)
<span>Series: UnempRate 
ARIMA(5,1,5)(1,0,0)[12]                    

Coefficients:
         ar1     ar2      ar3     ar4      ar5      ma1     ma2     ma3      ma4     ma5    sar1
      0.8299  0.0002  -0.1877  0.5283  -0.5790  -0.7431  0.0733  0.2183  -0.6230  0.7694  0.8827
s.e.  0.0942  0.0930   0.1124  0.0932   0.0665   0.0768  0.0701  0.0851   0.0736  0.0562  0.0233

sigma^2 estimated as 0.07499:  log likelihood=-104.71
AIC=233.42   AICc=233.81   BIC=290.02</span> 
</pre>
If you look at the residual analysis, you'll see the model sucks (in a technical sense).
Using <code>approximate=FALSE</code> doesn't change the result by much.  Even without looking at the residuals, it's clear that  model is a little crazy. And if you know what you're doing, you can beat it without much trouble by starting with Box and Jenkins catchall model <span class=eqn>ARIMA(0,1,1)(0,1,1)[12].</span>

<br/><br/>
Let's do another one - we could go on forever:
<pre class="prettyprint">
set.seed(666)
x = rnorm(1000)          # WHITE NOISE 
forecast::auto.arima(x)  # BLACK BOX
      
   # partial output 
     Series: x
     ARIMA(2,0,1) with zero mean
     
     Coefficients:
               ar1      ar2     ma1
           -0.9744  -0.0477  0.9509
     s.e.   0.0429   0.0321  0.0294
     
     sigma^2 estimated as 0.9657:  log likelihood=-1400
     AIC=2808.01   AICc=2808.05   BIC=2827.64
</pre>
ROTFLMAO: an ARMA(2,1)


<br/><br/> The bottom line is, it's not that hard to fit ARIMA models if you know what you're doing. And if you don't know what you're doing, maybe you shouldn't... do it, that is... well, unless you want to be president of the US... but that's another story.

<div class="up"><a href="#top" title="top">top</a></div>





<h2>Issue 3: when is the intercept the mean? </h2>  



When fitting ARIMA models, R calls the estimate
of the mean, the estimate of the intercept. This is ok if
there's no AR term, but not if there is an AR term. <br/>

<br/>For example, if <span class=eqn>x(t) = &alpha; + &phi;*x(t-1) + w(t)</span>
is stationary, then taking expectations,  
<span class=eqn>&mu; = &alpha; + &phi;*&mu;</span> or
<span class=eqn>&alpha; = &mu;*(1-&phi;).</span>  So, the intercept, <span class=eqn>&alpha;</span>,
is not the mean, <span class=eqn>&mu;</span>, unless <span class=eqn>&phi;=</span> 0. In general,
the mean and the intercept are the same only when there is no AR term.



Here's a numerical example:
<pre class="prettyprint">
# generate an AR(1) with mean 50
set.seed(66)      # so you can reproduce these results
x = arima.sim(list(order=c(1,0,0), ar=.9), n=100) + 50   
mean(x)<em class=blue>  
  [1] 50.60668   # the sample mean is close</em>
arima(x, order = c(1, 0, 0)) <em class=blue> 
  Coefficients:
           ar1  <SPAN STYLE="background-color: #e3e7ea">intercept </span>  # <-- <em class=red> here is the problem</em>
        0.8971  <SPAN STYLE="background-color: #e3e7ea">  50.6304 </span>  # <-- <em class=red> or here, one of these has to change</em>
  s.e.  0.0409     0.8365</em>
</pre>
 The result is telling you the estimated model is <br>
<span class=eqn>&nbsp;   x(t) = 50.6304 + .8971*x(t-1) + w(t)</span><br>
whereas, it should be telling you the estimated model is<br>
<span class=eqn>&nbsp;  x(t)&minus;50.6304 = .8971*[x(t-1)&minus;50.6304] + w(t)</span><br>
or <br>
<span class=eqn>&nbsp; x(t) = 5.21 + .8971*x(t-1) + w(t).</span><br/>
 Note that <span class=eqn>5.21 = 50.6304*(1-.8971)</span> is the intercept...  
 if it's not the intercept, then what is it??   



<br/><br/> So how did this happen?  I don't know, but I'll guess... if you write an AR(1) model as<br/>
<span class=eqn>&nbsp;x(t) = &mu; + &phi;*[x(t-1) - &mu;] + w(t)</span><br>
then   &mu;  looks like an intercept. Don't drink and code at the same time, kids.


<br/><br/>
The easy thing to do is simply change "intercept" to "mean":<pre class="prettyprint">
 <em class=blue> Coefficients:
           ar1     <SPAN STYLE="background-color: #e3e7ea">  mean </span> 
        0.8971    50.6304
  s.e.  0.0409     0.8365</em>
</pre>



<div class="up"><a href="#top" title="top">top</a></div>



<h2>Issue 4: your arima is drifting</h2>



When fitting ARIMA models with R, a constant term is NOT included
in the model if there is any differencing. The best R will do by default
is fit a mean if there is no differencing [type <code>?arima</code> for details].

What's wrong with this?  Well (with a time series in <span class=eqn>x</span>), for example:
<pre class="prettyprint">
arima(x, order = c(1, 1, 0))          # (1)
</pre> 
will not produce the same result as
<pre class="prettyprint">
arima(diff(x), order = c(1, 0, 0))    # (2)
</pre> 
because in (1), R will fit the model [with <span class=eqn>&nabla;x(s) = x(s)-x(s-1)</span>]<br>
  &nbsp;<span class=eqn> &nabla;x(t)= &phi;*&nabla;x(t-1) + w(t)</span> &nbsp;&nbsp;&nbsp;(no constant) <br>
whereas in (2), R will fit the model<br>
  &nbsp; <span class=eqn>&nabla;x(t) = &alpha; + &phi;*&nabla;x(t-1) + w(t).</span> &nbsp;&nbsp;&nbsp;(constant)<br/>

<br/>If there's drift (i.e., <span class=eqn>&alpha;</span> is NOT zero), the two fits can be extremely different
and using (1) will lead to an incorrect fit and consequently bad forecasts (see Issue 3 below). 



If <span class=eqn>&alpha;</span>  is NOT zero, then what you have to do to correct (1) is use xreg as follows:
<pre class="prettyprint">
arima(x, order = c(1, 1, 0), xreg=1:length(x))    # (1+)
</pre>
Why does this work?  In symbols, <span class=eqn> xreg = t</span> and consequently, 
 R will replace <span class=eqn>x(t)</span> with <span class=eqn>y(t) = x(t)-&beta;*t</span>;
that is, it will fit the model<br>
&nbsp;<span class=eqn>  &nabla;y(t)=   &phi;*&nabla;y(t-1) + w(t)</span>,
<br>or<br>
&nbsp;<span class=eqn>  &nabla;[x(t) - &beta;*t] =   &phi;*&nabla;[x(t-1) - &beta;*(t-1)] + w(t)</span>.<br>
Simplifying, <BR>
&nbsp;<span class=eqn> &nabla;x(t) = &alpha; +  &phi;*&nabla;x(t-1) + w(t)</span>
where <span class=eqn>  &alpha; =  &beta;*(1-&phi;)</span>. <br/>

<br/>
If you want to see the differences, generate a random walk with drift and
try to fit an ARIMA(1,1,0) model to it.  Here's how:
<pre class="prettyprint">
set.seed(1)           # so you can reproduce the results
v = rnorm(100,1,1)    # v contains 100 iid N(1,1) variates
x = cumsum(v)         # x is a random walk with drift = 1 
plot.ts(x)            # pretty picture...

arima(x, order = c(1, 1, 0))         #(1)
<em class=blue>
   Coefficients:
           ar1
        0.6031
  s.e.  0.0793
</em>
arima(diff(x), order = c(1, 0, 0))   #(2)
<em class=blue>
  Coefficients:
           ar1  intercept  <em class=red><-- remember, this is the mean of diff(x)</em>
       -0.0031     1.1163      <em class=red>and NOT the intercept</em>
  s.e.  0.1002     0.0897
</em>
arima(x, order = c(1, 1, 0), xreg=1:length(x))    #(1+)
<em class=blue>
  Coefficients:
            ar1  1:length(x)  <em class=red><-- this is the intercept of the model</em>
        -0.0031      1.1169      <em class=red>for diff(x)... got a headache?</em>                
  s.e.   0.1002      0.0897</em>
</pre>
  Let me explain what's going on here. The model generating the data is <br/>
<span class=eqn> x(t) = 1 + x(t-1) + w(t) </span><br>
where <span class=eqn>w(t)</span> is N(0,1) noise.  Another way to write this is<br/>
<span class=eqn>
   [x(t)-x(t-1)] = 1 + 0*[x(t-1)-x(t-2)] + w(t) </span><br/>
or<br/>
<span class=eqn>   &nabla;x(t) = 1 + 0*&nabla;x(t-1) + w(t) </span><br/>
so, if you fit an AR(1) to <span class=eqn>&nabla;x(t)</span>, the estimates should be, approximately,   <span class=eqn>ar1 = 0</span>
and <span class=eqn>intercept = 1</span>.<br/><br/>
     

Note that <span class=eqn>(1)</span> gives the WRONG answer because it's  forcing the regression 
to go through the origin.
But,  <span class=eqn>(2)</span> and <span class=eqn>(1+)</span> give the correct answers expressed in two different ways.
<div class="up"><a href="#top" title="top">top</a></div>




<a name="Issue3"></a>
<h2> Issue 5:  you call that a  forecast? </h2>  
If you want to get predictions from an ARIMA(p,d,q) fit when there is differencing (i.e., d > 0),
then the previous issue continues to be a problem.  Here's an example using the global temperature
data from Edition 2 of the text.  In what you'll see below, the <em class=red>first method</em> gives the <em class=red>wrong</em> results and
the <em class=blue>second method</em> gives the <em class=blue>correct</em> results.   If you use <code>sarima</code> and <code>sarima.for</code>, then you'll avoid these problems.
<pre class=prettyprint>
##--  WRONG --##
<span class=red>fit1 = arima(gtemp, order=c(1,1,1))</span>   
<span class=red>fore1 = predict(fit1, 15)</span>   

##-- Right --##
<span class=blue>nobs = length(gtemp)</span>                
<span class=blue>fit2 = arima(gtemp, order=c(1,1,1), xreg=1:nobs)</span>  
<span class=blue>fore2 = predict(fit2, 15, newxreg=(nobs+1):(nobs+15))</span>

##-- Plot --##
par(mfrow=c(2,1))
<span class=red>ts.plot(gtemp,fore1$pred, col=1:2, main="WRONG")</span>
<span class=blue>ts.plot(gtemp,fore2$pred, col=1:2, main="RIGHT")</span>

<img src="http://www.stat.pitt.edu/stoffer/tsa2/foreissue.jpg" alt="forecasting">
</pre>
<div class="up"><a href="#top" title="top">top</a></div>


<a name="Issue4"></a>
<h2> Issue 6: the wrong p-values </h2> 
If you use <code>tsdiag()</code> for diagnostics after an ARIMA fit, you will
get a graphic that looks like this: 
<pre class=prettyprint>
<img src="http://www.stat.pitt.edu/stoffer/tsa2/ex1.jpg" alt="tsdiag">
</pre>

The p-values shown for the Ljung-Box statistic plot are incorrect because the degrees
of freedom used to calculate the p-values are <span class=green>lag</span> instead of <span class=green>lag - (p+q)</span>.
That is, the procedure being used does NOT take into account the fact that the residuals are
from a fitted model. 



<div class="up"><a href="#top" title="top">top</a></div>

<h2> Issue 7:  lead from behind </h2>  

You have to be  careful when working with lagged components of a time
series. 
Note that <span class=eqn>lag(x)</span> is a FORWARD shift and <span class=eqn>lag(x,-1)</span> is a BACKWARD shift
(unless you happen to load <code>dplyr</code> ... <img src='images2/slaphead.gif'>).
Try a small example:
<pre class="prettyprint">
x = ts(1:5)
cbind(x, lag(x), lag(x,-1))
<em class=blue>
Time Series:
Start = 0 
End = 6 
Frequency = 1 
    x lag(x) lag(x, -1)
0  NA     1         NA
1   1     2         NA
2   2     3          1
3  <SPAN STYLE="background-color: #e3e7ea"> 3     4          2 </span> ## in this row, x is 3, lag(x) is 4, lag(x,-1) is 2
4   4     5          3               
5   5    NA          4
6  NA    NA          5</em>
</pre>
In other words,  if you have a series <span class=eqn>x(t),</span>
then <br>
<span class=eqn> y(t) = lag{x(t)} = x(t+1)</span>, and NOT <span class=eqn>x(t-1)</span>.<br> 
In fact, this is reasonable in that y(t) actually does "lag" x(t) by one time period.
But, it seems awkward, and it's not typical of other programs.
As long as you know the convention, you'll be ok ...<br><br>

... well, then I started wondering how this plays out in other things.
If you do a lag plot 
<pre class="prettyprint">
x = rnorm(500)
lag.plot(x)
</pre>
you get  <span class=eqn>x(t)</span> [vertical axis] vs <span class=eqn>x(t+1)</span> [horizontal axis], but your brain is saying it's <span class=eqn>x(t-1)</span>  on the horizontal.
<pre class="prettyprint">
<img src="http://www.stat.pitt.edu/stoffer/tsa3/lag_plot.png" alt="lag_plot">
</pre>




So, I started playing around with some other commands.  In what you'll see
next, I'm using two simultaneously measured series presented in the text called <span class=eqn>soi</span>
and <span class=eqn>rec</span>... it doesn't matter what they are for this demonstration.
First, I entered the command 
<pre class="prettyprint">acf(cbind(soi, rec))

# and I got:
<img src="http://www.stat.pitt.edu/stoffer/tsa2/ccf0.jpg" alt="ccf0">
</pre> 

Before you scroll down, try to figure out what the graphs are giving you
(in particular, the off-diagonal plots ... and yes they're CCFs, but what's the lead-lag
relationship in each plot???) ...<br>
.<br>
.<br>
.<br>
.<br>
.<br>
.<br>
.<br>
... here you go:
<pre class="prettyprint">
<img src="http://www.stat.pitt.edu/stoffer/tsa2/ccf.jpg" alt="ccf">
</pre>

The jpg is messy, but you'll get the point... the writing is mine. 
When you see something like 'rec "leads" here',  it means
rec comes in time before soi, and so on.  
  Anyway, to be consistent, shouldn't the graph in the 2nd row, 1st column
be corr{rec(t+Lag}, soi(t)} for positive values of Lag ... or ...
shouldn't the title be <strong>soi &amp; rec</strong>??  oops. 

  
<br/><br/>
Now, try this
<pre class="prettyprint">ccf(soi,rec)

# and you get
<img src="http://www.stat.pitt.edu/stoffer/tsa2/soirec.jpg" alt="ccf2"   >
</pre>  

What you're seeing is <span class=eqn>corr{soi(t+Lag), rec(t)}</span> versus 
<span class=eqn>Lag</span>.  So on the
positive side of Lag, rec leads, and on the negative side of Lag, soi leads.
 



<br/><br/>
We're not done with this yet.  
If you want to do a regression of <span class=eqn>x</span> on <span class=eqn>lag(x,-1)</span>, for example, you have to "tie" them 
together first. Here's an example.
<pre class="prettyprint">
x = arima.sim(list(order=c(1,0,0), ar=.9), n=20)  # 20 obs from an AR(1)
xb1 = lag(x,-1)
##  you wouldn't regress  x on lag(x) because that would be progress  ;-)  
 
 ##-- WRONG: 
cor(x,xb1)  # correlation
  # [1] 1     ... is one?   
lm(x~xb1)   # regression    
  # Coefficients:
  # (Intercept)         xb1  
  #  6.112e-17    1.000e+00  
## do it the WRONG way and you will think x(t)=x(t-1)
    
    
##-- RIGHT:
y=cbind(x,xb1)   # tie them together first
lm(y[,1]~y[,2])  # regression 
  # Coefficients:
  # (Intercept)       y[, 2]  
  #     0.5022       0.7315  

##-- OR:
y=ts.intersect(x,xb1)  # tie them together first this way
lm(y[,1]~y[,2])  # regression  
  # Coefficients:                              
  # (Intercept)       y[, 2]                   
  #     0.5022       0.7315             
cor(y[,1],y[,2]) # correlation
  # [1] 0.842086

##--By the way, (Intercept) is used correctly here.
</pre>
R does warn you about this (type <code>?lm</code> and scroll down to "Using time series"), so consider
this a heads-up, rather than an issue.  See our little tutorial for more info on this.
<div class="up"><a href="#top" title="top">top</a></div>





<h2>Issue 8: u-g-l-y, you ain't got no alibi
 </h2> 

When you're trying to fit an ARMA model to data, one of the first things you
do is look at the ACF and PACF of the data.  Let's try this for a simulated
MA(1) process. Here's how:
<pre class="prettyprint">
MA1 = arima.sim(list(order=c(0,0,1), ma=.5), n=100)
par(mfcol=c(2,1))
acf(MA1,20)
pacf(MA1,20)
and here's the output:
<img src="http://www.stat.pitt.edu/stoffer/tsa2/ma1.jpg" alt="ma1">
</pre>

What's wrong with this picture?  First, the two graphs are on  different scales. The ACF axis goes from -.2 to 1, whereas the PACF axis goes from -.2 to .4.
Also, the lag axis on the ACF plot starts at 0 (the 0 lag ACF is always 1 so you have to ignore it or put your thumb over it), whereas the lag axis on the PACF plot starts at 1.

So, instead of getting a nice picture by default, you get a messy picture.
Ok, the remedy is as follows:
<pre class="prettyprint">
par(mfrow=c(2,1))
acf(MA1,20,xlim=c(1,20))   # set the x-axis limits to start at 1 then
                           # look at the graph and note the y-axis limits
pacf(MA1,20,ylim=c(-.2,1)) # then use those limits here

#and here's the output:
<img src="http://www.stat.pitt.edu/stoffer/tsa2/ma1a.jpg" alt="ma1a">
</pre>

Looks nice, but who wants to get carpal tunnel syndrome
sooner than necessary?  Not me... and hence <code>acf2</code> was born. 
<div class="up"><a href="#top" title="top">top</a></div>



	
  
  
  
  
  

						</div>
					</div>
				</div>
				
			</section>		
			
</div>
		<!-- Footer -->
			<footer id="footer">
				<div class="copyright">
					&copy; <a href="http://www.stat.pitt.edu/stoffer/"> D.S. Stoffer</a>
				</div>
			</footer>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

			
<!-- Start of StatCounter Code for Default Guide  
<script type="text/javascript">
var sc_project=11025450; 
var sc_invisible=1; 
var sc_security="9f3c973f"; 
var scJsHost = (("hcodeps:" == document.location.protocol) ?
"hcodeps://secure." : "hcodep://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="web analytics"
href="hcodep://statcounter.com/" target="_blank"><spanmg
class="statcounter"
src="//c.statcounter.com/11025450/0/9f3c973f/1/" alt="web
analytics"></a></div></noscript>
  End of StatCounter Code for Default Guide -->				
	</body>
</html>